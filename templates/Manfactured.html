<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>OmniPro Pvt Ltd</title>
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />


        <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
        <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet" crossorigin="anonymous" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" crossorigin="anonymous"></script>
        <link href="https://fonts.googleapis.com/css2?family=Lora:wght@700&display=swap" rel="stylesheet">
        <style>

        </style>
    </head>
    <body class="sb-nav-fixed">
        {% include "header.html"%}

            <div id="layoutSidenav_content">
                <main>
                   
                   
                        <form action="{{ url_for('Manfactured') }}" method="POST" enctype="multipart/form-data">
                            
                                <div id="dialog" class="modal">
                                    <div class="modal-content">
                                        <span class="close">&times;</span>
                                        <h2>Add New Manufacturer_Products</h2>
                                        <form id="productForm">
                                            <div class="form-row">
                                                <div class="form-group col-md-6">
                                                    <label for="manufacturer_name"><b>Manufacturer Name:</b></label>
                                                    <select class="form-select" id="manufacturer_name" name="manufacturer_name" onchange="checkManufacturerName()">
                                                        <option value="">Select Manufacturer Name</option>
                                                        {% if suppliers %}
                                                            {% for supplier in suppliers %}
                                                                <option value="{{ supplier[0] }}">
                                                                    {{ supplier[0] }}
                                                                </option>
                                                            {% endfor %}
                                                        {% else %}
                                                            <option value="">No suppliers available</option>
                                                        {% endif %}
                                                    </select>
                                                    <div id="nameError" class="text-danger"></div>

                                                </div>
                                                <div class="form-group col-md-4">
                                                    <label for="remarks"><b>Remarks:</b></label>
                                                    <textarea class="form-control" id="remarks" name="remarks" placeholder="Enter remarks" rows="2"></textarea>
                                                </div>
                                                <div class="form-group col-md-4">
                                                    <label for="applications"><b>Applications:</b></label>
                                                    <textarea class="form-control" id="applications" name="applications" placeholder="Enter applications" rows="2"></textarea>
                                                </div>
                                            </div>
                                            <div class="containerr">
                                                <h5>Product Details</h5>
                                                <table id="productTable" >
                                                    <thead>
                                                        <tr>
                                                            <th>Product Name</th>
                                                            <th>Added By</th>
                                                            <th>Remarks</th>
                                                            <th>Date</th>
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <!-- Initial row will be inserted here by JavaScript -->
                                                    </tbody>
                                                </table>
                                                <button id="addRowBtn" type="button" class="btn btn-success">+</button>
                                                <div class="form-row">
                                               
                                                <div class="form-group col-md-3">
                                                    <label for="file"><b>Upload Excel:</b></label>
                                                    <input type="file" class="form-control" id="file" name="file" accept=".xlsx, .xls"><br>
                                                    <a id="download_link" href="/uploads/manfactured.xlsx">Download Sample File</a><br><br>

                                                </div>
                                                <!-- <a id="download_link" href="/uploads/supplier-contacts.xlsx">Download Sample File</a><br><br> -->

                                            </div>


                                            </div>
                                            <div class="form-row">
                                                <button type="submit" style="width: 5%;" class="btn btn-primary btn-sm">Submit</button><br>

                                                <button type="button" style="width: 5%;margin-left:10px;" class="btn btn-secondary btn-sm" id="close_modal">Close</button>
                                        </div>
                                        </form>
                                    </div>
                                </div>
                            </form>
                       
                    
                        <div class="card mb-4">
                            <div class="card-header" style="padding: 5px 10px; height: 50px;">
                                <div class="d-flex justify-content-between align-items-center h-100">
                                    <!-- Left-side buttons (Add, Contacts, Export) -->
                                    <div class="d-flex align-items-center" style="gap: 10px;">
                                        <button id="addNewBtn" type="button" class="btn btn-primary" 
                                                style="padding: 5px 10px; font-size: 0.85rem; border-radius: 5px;">
                                            <i class="fas fa-plus"></i> Add
                                        </button>
                                        
                                        <a href="{{ url_for('export_Manfactured_products_data') }}">
                                            <button type="button" class="btn btn-success" 
                                                    style="padding: 5px 10px; font-size: 0.85rem; border-radius: 5px;">
                                                Export
                                            </button>
                                        </a>
                                        <a href="{{ url_for('manage_product') }}">
                                            <button type="button" class="btn btn-danger" 
                                                    style="padding: 5px 10px; font-size: 0.85rem; border-radius: 5px;">
                                                Products
                                            </button>
                                        </a>
                                    </div>
                                    <h2 style="color: #20B2AA;"> MANUFACTURER PRODUCTS</h2>
                                    <!-- Right-side Search form -->
                                    <div class="d-flex align-items-center">
                                        <form method="GET" action="{{ url_for('Manfactured') }}" class="d-flex align-items-center" enctype="multipart/form-data" style="gap: 5px;">
                                            <label for="search" class="mb-0" style="margin-right: 5px; font-size: 0.85rem;">Search:</label>
                                            <input type="text" id="search" name="search" value="{{ search_query }}" 
                                                   class="form-control form-control-sm" style="padding: 5px; font-size: 0.85rem; border-radius: 5px;">
                                            <button type="submit" class="btn btn-primary" style="padding: 5px 10px; font-size: 0.85rem; border-radius: 5px;">
                                                Search
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th scope="col">S.No</th>
                                                <th scope="col">Manufacturer Name</th>
                                                <th scope="col">Remarks</th>
                                                <th scope="col">Application</th>
                                               
                                             
                                                <th scope="col">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for record in manufacturerproduct %}
                                            <tr>
                                                <td>{{ (page - 1) * per_page + loop.index }}</td>
                                                <td>{{ record[1] }}</td>
                                                <td>{{ record[2] }}</td>
                                                <td>{{ record[3] }}</td>
                                               
                                           
                                                <td>
                                                    <a href="/update_manfactured/{{record.0}}" class="btn btn-warning btn-sm"
                                                    data-toggle="modal" data-target="#modaleditup{{record.0}}"
                                                    style="position: relative; display: inline-block; cursor: pointer;"
                                                    onmouseover="this.querySelector('.tooltiptext').style.visibility = 'visible'; this.querySelector('.tooltiptext').style.opacity = '1';"
                                                    onmouseout="this.querySelector('.tooltiptext').style.visibility = 'hidden'; this.querySelector('.tooltiptext').style.opacity = '0';">
                                                    <i class="fas fa-edit"></i>
                                                    <span class="tooltiptext" style="
                                                        visibility: hidden;
                                                        width: 100px;
                                                        background-color: black;
                                                        color: #fff;
                                                        text-align: center;
                                                        border-radius: 5px;
                                                        padding: 5px;
                                                        position: absolute;
                                                        z-index: 1;
                                                        bottom: 125%;
                                                        left: 50%;
                                                        margin-left: -50px;
                                                        opacity: 0;
                                                        transition: opacity 0.3s;
                                                    ">Edit</span>
                                                 </a>
                                                 
                                                 <!-- Delete Button -->
                                                 <a href="/delete_manfactured/{{ record.0 }}" onclick="return confirm('Are you sure you want to delete?');" class="btn btn-danger btn-sm"
                                                    style="position: relative; display: inline-block; cursor: pointer;"
                                                    onmouseover="this.querySelector('.tooltiptext').style.visibility = 'visible'; this.querySelector('.tooltiptext').style.opacity = '1';"
                                                    onmouseout="this.querySelector('.tooltiptext').style.visibility = 'hidden'; this.querySelector('.tooltiptext').style.opacity = '0';">
                                                    <i class="fas fa-trash-alt"></i>
                                                    <span class="tooltiptext" style="
                                                        visibility: hidden;
                                                        width: 100px;
                                                        background-color: black;
                                                        color: #fff;
                                                        text-align: center;
                                                        border-radius: 5px;
                                                        padding: 5px;
                                                        position: absolute;
                                                        z-index: 1;
                                                        bottom: 125%;
                                                        left: 50%;
                                                        margin-left: -50px;
                                                        opacity: 0;
                                                        transition: opacity 0.3s;
                                                    ">Delete</span>
                                                 </a>
                                                 <a href="/add_manfactured/{{ record[0] }}" class="btn btn-primary btn-sm"
                                                                data-toggle="modal" data-target="#modaleditad{{ record[0] }}"
                                                                style="position: relative; display: inline-block; cursor: pointer;"
                                                                onmouseover="this.querySelector('.tooltiptext').style.visibility = 'visible'; this.querySelector('.tooltiptext').style.opacity = '1';"
                                                                onmouseout="this.querySelector('.tooltiptext').style.visibility = 'hidden'; this.querySelector('.tooltiptext').style.opacity = '0';">
                                                                +
                                                                <span class="tooltiptext" style="
                                                                    visibility: hidden;
                                                                    width: 120px;
                                                                    background-color: black;
                                                                    color: #fff;
                                                                    text-align: center;
                                                                    border-radius: 5px;
                                                                    padding: 5px;
                                                                    position: absolute;
                                                                    z-index: 1;
                                                                    bottom: 125%;
                                                                    left: 50%;
                                                                    margin-left: -60px;
                                                                    opacity: 0;
                                                                    transition: opacity 0.3s;
                                                                ">Add Product</span>
                                                             </a>
                                                             <a href="/add_excel/{{ record[0] }}" class="btn btn-success btn-sm"
                                                                data-toggle="modal" data-target="#modaleditex{{ record[0] }}"
                                                                style="position: relative; display: inline-block; cursor: pointer;"
                                                                onmouseover="this.querySelector('.tooltiptext').style.visibility = 'visible'; this.querySelector('.tooltiptext').style.opacity = '1';"
                                                                onmouseout="this.querySelector('.tooltiptext').style.visibility = 'hidden'; this.querySelector('.tooltiptext').style.opacity = '0';">
                                                                <span class="material-symbols-outlined">
                                                                    cloud_upload
                                                                    </span>
                                                                <span class="tooltiptext" style="
                                                                    visibility: hidden;
                                                                    width: 120px;
                                                                    background-color: black;
                                                                    color: #fff;
                                                                    text-align: center;
                                                                    border-radius: 5px;
                                                                    padding: 5px;
                                                                    position: absolute;
                                                                    z-index: 1;
                                                                    bottom: 125%;
                                                                    left: 50%;
                                                                    margin-left: -60px;
                                                                    opacity: 0;
                                                                    transition: opacity 0.3s;
                                                                ">Import</span>
                                                             </a>




                                                </td>
                                                
                                            </tr>
                                            <div class="modal fade" id="modaleditad{{ record[0] }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="exampleModalLabel"> Add Product </h5>
                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body">
                                            
                                                            <form method="post" action="{{ url_for('add_manfactured') }}" enctype="multipart/form-data" >
                                                                <div class="form-group">
                                                                    <label for="modal-name"> manufacturer Name</label>
                                                                    <select class="form-control" id="manufacturer_name" name="manufacturer_name">
                                                                        {% for branch in manufacturerproduct %}
                                                                            <option value="{{ branch[1] }}" {% if branch[1] == record[1] %} selected {% endif %}>{{ branch[1] }}</option>
                                                                        {% endfor %}
                                                                    </select>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="modal-email">Product name</label>
                                                                    <input type="text" class="form-control" id="productname" name="productname" required>
                                                                </div>
                                                                
                                                                 
                                                               
                                                                
                                                                
                                                                
                                                                <div class="form-group">
                                                                    <label for="modal-email">Added By</label>
                                                                    <select class="form-control" id="addedby" name="addedby">
                                                                        {% for branch in employee %}
                                                                            <option value="{{ branch[1] }}">{{ branch[1] }}</option>
                                                                        {% endfor %}
                                                                    </select>
                                                                </div>


                                                                <div class="form-group"></div>
                                                                    <label for="modal-email">Remarks</label>
                                                                    <input type="text" class="form-control" id="modal-email" name="" >
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="modal-email">Date</label>
                                                                    <input type="date" class="form-control" id="date" name="date">
                                                                </div>
                                                                
                                            
                                                                <button type="submit" class="btn btn-primary">Submit</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal fade" id="modaleditex{{ record[0] }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="exampleModalLabel"> Add Product </h5>
                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body">
                                            
                                                            <form method="post" action="{{ url_for('add_excel') }}" enctype="multipart/form-data" >
                                                                <div class="form-group">
                                                                    <label for="modal-name"> manufacturer Name</label>
                                                                    <select class="form-control" id="manufacturer_name" name="manufacturer_name">
                                                                        {% for branch in manufacturerproduct %}
                                                                            <option value="{{ branch[1] }}" {% if branch[1] == record[1] %} selected {% endif %}>{{ branch[1] }}</option>
                                                                        {% endfor %}
                                                                    </select>
                                                                </div>
                                                                
                                                                <div class="form-group ">
                                                                    <label for="file">Upload Excel:</label>
                                                                    <input type="file" class="form-control" id="file" name="file" accept=".xlsx, .xls">
                                                                </div>
                                                                <a id="download_links" href="{{ url_for('download_sample_excel_manfactured') }}" download>Download Sample File</a><br>
                                            
                                                                <button type="submit" class="btn btn-primary">Submit</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>





                                            <div id="modaleditup{{ record[0] }}" class="modal fade" role="dialog">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Update Manufactured Product</h4>
                                                            <span class="b" style="width: 30px; cursor: pointer; font-size: 24px; padding: 5px; display: inline-block; text-align: center; font-weight: bold;" data-dismiss="modal">x</span>
                                                        </div>
                                                        <div class="modal-body">
                                                            <form action="{{ url_for('update_manfactured') }}" method="POST">
                                                                <!-- Hidden field to pass the record ID -->
                                                                <input type="hidden" name="id" value="{{ record[0] }}">
                                                                
                                                                <div class="form-group">
                                                                    <label>Manufacturer Name</label>
                                                                    <select class="form-control" name="manufacturer_name">
                                                                        {% for branch in suppliers %}
                                                                            <option value="{{ branch[0] }}" {% if branch[0] == record[1] %} selected {% endif %}>
                                                                                {{ branch[0] }}
                                                                            </option>
                                                                        {% endfor %}
                                                                    </select>
                                                                    
                                                                </div>
                                                                
                                                                <div class="form-group">
                                                                    <label>Remarks</label>
                                                                    <input type="text" class="form-control" name="remarks" value="{{ record[2] }}">
                                                                </div>
                                                                
                                                                <div class="form-group">
                                                                    <label>Applications</label>
                                                                    <input type="text" class="form-control" name="applications" value="{{ record[3] }}">
                                                                </div>
                                            
                                                                <button type="submit" class="btn btn-primary">Update</button>
                                                            </form>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                <!-- </div> -->
                            </div>
                      
                    <ul class="pagination" style="display: flex;justify-content: flex-end;padding: 20px;">
                        {% if page > 1 %}
                        <li><a href="{{ url_for('Manfactured', page=1, search=search_query) }}">First</a></li>
                        <li><a href="{{ url_for('Manfactured', page=page-1, search=search_query) }}">Previous</a></li>
                        {% endif %}
                        {% for p in range(1, total_pages + 1) %}
                        <li><a href="{{ url_for('Manfactured', page=p, search=search_query) }}">{{ p }}</a></li>
                        {% endfor %}
                        {% if page < total_pages %}
                        <li><a href="{{ url_for('Manfactured', page=page+1, search=search_query) }}">Next</a></li>
                        <li><a href="{{ url_for('Manfactured', page=total_pages, search=search_query) }}">Last</a></li>
                        {% endif %}
                    </ul>
                </main>
            <!-- </div>
        </div> -->
                   
                </div>
            </div>
            {%include "footer.html"%}

            <script>
                // Get today's date in the format YYYY-MM-DD
                var today = new Date().toISOString().split('T')[0];
                
                // Set the max attribute to today's date
                document.getElementById('date').setAttribute('max', today);
            </script>
            <script>
                // Show the modal when the "Add" button is clicked
                document.getElementById('addNewBtn').addEventListener('click', function() {
                    document.getElementById('dialog').style.display = 'block';
                });
            
                // Close the modal when the "x" button is clicked
                document.getElementsByClassName('close')[0].addEventListener('click', function() {
                    document.getElementById('dialog').style.display = 'none';
                });
            
                // Close the modal when clicking outside of it
                window.addEventListener('click', function(event) {
                    if (event.target == document.getElementById('dialog')) {
                        document.getElementById('dialog').style.display = 'none';
                    }
                });
            
                // Add a new row to the product table
                document.getElementById('addRowBtn').addEventListener('click', function(event) {
                    event.preventDefault(); // Prevent the form from submitting
            
                    // Create a new row
                    var table = document.getElementById('productTable').getElementsByTagName('tbody')[0];
                    var newRow = table.insertRow();
            
                    // Insert cells and input fields into the new row
                    var cell1 = newRow.insertCell(0);
                    var cell2 = newRow.insertCell(1);
                    var cell3 = newRow.insertCell(2);
                    var cell4 = newRow.insertCell(3);
                    var cell5 = newRow.insertCell(4);
            
                    cell1.innerHTML = '<input type="text" name="productname[]" oninput="this.value = this.value.toUpperCase()" style="text-transform: uppercase;">';
                                        var dropdown = document.createElement('select');
                    dropdown.name = 'addedby[]';
                    cell2.appendChild(dropdown);
            
                    // Fetch employee names from Flask and populate the dropdown
                    fetch('/get_employee_names')
                        .then(response => response.json())
                        .then(data => {
                            data.forEach(function(name) {
                                var option = document.createElement('option');
                                option.value = name;
                                option.text = name;
                                dropdown.add(option);
                            });
                        });
                        cell3.innerHTML = '<input type="text" name="remarks[]" oninput="this.value = this.value.toUpperCase()" style="text-transform: uppercase;">';

// Assuming cell4 is already defined as a cell in your table row
    cell4.innerHTML = `<input type="date" name="date[]" max="${new Date().toISOString().split('T')[0]}">`;
                    cell5.innerHTML = '<button type="button" class="deleteRowBtn">x</button>';
            
                    // Add delete functionality to the new delete button
                    var deleteButtons = document.getElementsByClassName('deleteRowBtn');
        for (var i = 0; i < deleteButtons.length; i++) {
            deleteButtons[i].addEventListener('click', function() {
                if (confirm('Are you sure you want to remove this row?')) {
                    this.parentElement.parentElement.remove();
                }
            });
        }
    });
                
            </script>
            {%include'close.html'%}
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="js/scripts.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
        <script src="assets/demo/chart-area-demo.js"></script>
        <script src="assets/demo/chart-bar-demo.js"></script>
        <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
        <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
        <script src="assets/demo/datatables-demo.js"></script>
        <script>
            $(document).ready(function() {
                // Set the active link on page load based on the current URL
                var currentPath = window.location.pathname;
                $('.sb-sidenav .nav-link').each(function() {
                    var linkPath = $(this).attr('href');
                    if (currentPath.indexOf(linkPath) !== -1) {
                        $(this).addClass('active');
                    }
                });
        
                // Update the active link on click
                $('.sb-sidenav .nav-link').on('click', function() {
                    $('.sb-sidenav .nav-link').removeClass('active');
                    $(this).addClass('active');
                });
            });
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var filePath = '/download/manfactured.xlsx'; // Path to your download route
                var downloadLink = document.getElementById('download_link');
                
                // Set the href attribute to the file path
                downloadLink.href = filePath;
                downloadLink.download = 'manfactured.xlsx'; // Optional: specify the filename for the download
            });
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var filePath = '/download/manfactured.xlsx'; // Path to your download route
                var downloadLink = document.getElementById('download_links');
                
                // Set the href attribute to the file path
                downloadLink.href = filePath;
                downloadLink.download = 'manfactured.xlsx'; // Optional: specify the filename for the download
            });
        </script>
        <script>
            function checkManufacturerName() {
                var manufacturername = document.getElementById('manufacturer_name').value;
                if (manufacturername) {
                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', '/check_manufacturer_product_name', true);
                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                    xhr.onload = function () {
                        if (xhr.status === 200) {
                            var response = JSON.parse(xhr.responseText);
                            var nameError = document.getElementById('nameError');
                            if (response.exists) {
                                nameError.textContent = ' name already exists. Please choose a different name.';
                            } else {
                                nameError.textContent = '';
                            }
                        }
                    };
                    xhr.send('manufacturername=' + encodeURIComponent(manufacturername));
                }
            }
        </script>
    </body>

</html>
{% extends "uppercase.html" %}
{% include "alert.html" %}
